# 9. 基于 HTTP 的功能追加协议

## 9.1 HTTP 瓶颈（HTTP 2 之前的版本）

-   一条连接上只可发送一个请求。
-   请求只能从客户端开始。客户端不可以接收除响应以外的指令。
-   请求 / 响应首部未经压缩就发送。首部信息越多延迟越大。
-   发送冗长的首部。每次互相发送相同的首部造成的浪费较多。
-   可任意选择数据压缩格式。非强制压缩发送。

**Ajax 的解决方式：**

XMLHttpRequest API 发送请求，更新局部页面。由于只更新一部分页面，传输的数据量会减少，但是并未解决 HTTP 本身的问题。

**Comet 的解决方式：**

一旦服务器端有内容更新了，Comet 不会让请求等待，而是直接给客户端返回响应。这是一种通过延迟应答，模拟实现服务器端向客户端推送(Server Push)的功能。

内容上虽然实时更新了，但为了保留响应，一次连接的持续时间也变长了。为了维持连接还会消耗更多的资源。仍未解决 HTTP 协议本身存在的问题。

**SPDY 的目标**

协议级别消除 HTTP 瓶颈。

## 9.2 SPDY

SPDY 以会话层的形式加入，控制对数据的流动，但还是采用 HTTP 建立通信连接。

增加了一下功能：

-   多路复用
-   请求优先级
-   压缩首部
-   服务器推送

HTTP/2 的关键功能主要来自 SPDY 技术，换言之，SPDY 的成果被采纳而最终演变为 HTTP/2。

## 9.3 WebSocket

利用 Ajax 和 Comet 技术进行通信可以提升 Web 的浏览速度。但问题 在于通信若使用 HTTP 协议，就无法彻底解决瓶颈问题。WebSocket 网络技术正是为解决这些问题而实现的一套新协议及 API。

WebSocket，即 Web 浏览器与 Web 服务器之间全双工通信标准。

由于是建立在 HTTP 基础上的协议，因此连接的发起方仍是客户端， 而一旦确立 WebSocket 通信连接，不论服务器还是客户端，任意一方都可直接向对方发送报文。

主要特点：
- 推动功能：支持服务器向客户端推送数据。
- 减少通信量：连接建立后，一直保持连接状态。由于 WebSocket 首部信息很少，通信量也减少了。

握手步骤：

- 请求：为了实现 WebSocket 通信，需要用到 HTTP 的 Upgrade 首部字段，告知服务器通信协议发生改变。
- 响应：状态码 101 Switching Protocols 的响应。